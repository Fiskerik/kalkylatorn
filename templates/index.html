<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <title>F칬r칛ldrapenningskalkylator</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <h1>游놌 F칬r칛ldrapenningskalkylator</h1>
    <section class="block">
        <h2>V칛lj v친rdnadsform</h2>
      
        <div class="button-group">
          <button type="button" onclick="selectCare('joint')">Gemensam v친rdnad</button>
          <button type="button" onclick="selectCare('single')">Ensam v친rdnad</button>
        </div>
      
        <div id="care-info" class="info-text" style="margin-top: 1em;"></div>
      
        <div id="income-section" style="display: none; margin-top: 1em;">
          <label for="income">Vad 칛r din m친nadsinkomst f칬re skatt?</label><br>
          <input type="number" id="income" placeholder="30 000 kr" style="padding: 8px; width: 200px;">
          <br><br>
          <button onclick="calculate()">Visa resultat</button>
        </div>
      
        <div id="result-section" style="margin-top: 2em;"></div>
      </section>
      
      <script>
        let daysAvailable = 0;
      
        function selectCare(type) {
          const info = document.getElementById("care-info");
          const incomeSection = document.getElementById("income-section");
      
          if (type === "joint") {
            daysAvailable = 195;
            info.innerHTML = `N칛r du och den andra f칬r칛ldern har gemensam v친rdnad f친r ni <strong>195 dagar</strong> var p친 sjukpenningniv친.`;
          } else if (type === "single") {
            daysAvailable = 390;
            info.innerHTML = `Du som har ensam v친rdnad f친r <strong>390 dagar</strong> p친 sjukpenningniv친.`;
          }
      
          incomeSection.style.display = "block";
          document.getElementById("result-section").innerHTML = ""; // Clear previous results
        }
      
        function calculate() {
          const income = parseFloat(document.getElementById("income").value);
          if (isNaN(income) || income <= 0) {
            alert("Ange en giltig inkomst.");
            return;
          }
      
          // Enkel Fk-modell: ca 80% av SGI upp till taket
          const dailyAllowance = Math.min(income * 0.8 / 30, 1116); // ca tak i 2024: 1116 kr/dag
          const dailyRounded = Math.round(dailyAllowance);
      
          let resultHtml = `<p>Du kan prelimin칛rt f친 <strong>${dailyRounded.toLocaleString('sv-SE')} kronor</strong> per dag i f칬r칛ldrapenning.</p>`;
          resultHtml += `
            <table border="1" cellpadding="8" style="border-collapse: collapse; margin-top: 1em;">
              <thead>
                <tr>
                  <th>Dagar per vecka</th>
                  <th>S친 l칛nge r칛cker dagarna</th>
                  <th>F칬r칛ldrapenning per m친nad</th>
                </tr>
              </thead>
              <tbody>`;
      
          for (let i = 1; i <= 7; i++) {
            const weeks = daysAvailable / i;
            const months = weeks / 4.3;
            const monthlyPay = dailyRounded * i * 4.3;
            const monthlyRounded = Math.round(monthlyPay / 100) * 100;
      
            resultHtml += `
              <tr>
                <td>${i} dag${i > 1 ? 'ar' : ''}</td>
                <td>${Math.floor(weeks)} veckor</td>
                <td>${monthlyRounded.toLocaleString('sv-SE')} kr</td>
              </tr>`;
          }
      
          resultHtml += `</tbody></table>`;
          document.getElementById("result-section").innerHTML = resultHtml;
        }
      </script>

      

      
    
    <form method="POST">
        <label for="parent">V칛lj f칬r칛lder:</label>
        <select name="parent" id="parent">
            <option value="F칬r칛lder 1">F칬r칛lder 1</option>
            <option value="F칬r칛lder 2">F칬r칛lder 2</option>
        </select>

        <label for="income">칀rsinkomst (brutto):</label>
        <input type="number" name="income" id="income" required>

        <label for="days_80">Antal dagar p친 80%-niv친 (max 390):</label>
        <input type="number" name="days_80" id="days_80" max="390" required>

        <label for="days_180">Antal dagar p친 l칛gstaniv친 (max 90):</label>
        <input type="number" name="days_180" id="days_180" max="90" required>

        <button type="submit">游눯 Ber칛kna</button>
    </form>

    {% if result %}
    <section class="result">
        <h2>游늵 Resultat f칬r {{ result.parent }}</h2>
        <p><strong>Ers칛ttning per dag (80%):</strong> {{ result.sgi_per_day }} kr</p>
        <p><strong>{{ result.dagar_80 }} dagar</strong> p친 80%-niv친: {{ result.ers_80 | round }} kr</p>
        <p><strong>{{ result.dagar_180 }} dagar</strong> p친 l칛gstaniv친: {{ result.ers_180 }} kr</p>
        <p><strong>Total ers칛ttning:</strong> {{ result.total | round }} kr</p>
        <p><strong>Kvarvarande dagar:</strong> {{ result.remaining }} / 480</p>

        <canvas id="chart" width="400" height="200"></canvas>
        <script>
            const ctx = document.getElementById('chart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['80%-niv친', 'L칛gstaniv친'],
                    datasets: [{
                        label: 'Ers칛ttning (kr)',
                        data: [{{ result.ers_80 | round(2) }}, {{ result.ers_180 | round(2) }}],
                        backgroundColor: ['#4CAF50', '#2196F3']
                    }]
                },
                options: {
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });
        </script>
    </section>
    {% endif %}
</body>
</html>
